<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consolidado</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        th:first-child { position: sticky; left: 0; background: var(--accent); z-index: 10; width: 250px; }
        td:first-child { position: sticky; left: 0; background: #f8fafc; z-index: 5; border-right: 2px solid var(--border); font-weight: 600; text-align: left; }
        .row-highlight td { background-color: #dcfce7 !important; color: #166534; font-weight: 700; }
        .row-total-main td { font-weight: 800; color: var(--primary); border-top: 2px solid var(--border); }
        .row-sub-header td { background-color: #eff6ff !important; font-weight: 700; color: var(--primary); text-align: left; }
    </style>
</head>
<body>

<div class="container">
    <div class="top-controls">
        <div class="control-group">
            <label>Tipo</label>
            <select id="period-type" onchange="atualizarOpcoes()">
                <option value="dia">Dia</option>
                <option value="mes" selected>Mensal (Semanal)</option>
                <option value="trimestre">Trimestral</option>
                <option value="semestre">Semestral</option>
                <option value="ano_mes">Anual (Mensal)</option>
                <option value="ano_tri">Anual (Trimestral)</option>
            </select>
        </div>
        <div class="control-group" id="group-year"><label>Ano</label><select id="year-selector" onchange="atualizarOpcoes()"></select></div>
        <div class="control-group" id="group-dynamic" style="flex:1.5"><label id="dynamic-label">Período</label><select id="period-value" onchange="carregarRelatorio()"></select><input type="date" id="date-picker" class="hidden" onchange="carregarRelatorio()"></div>
    </div>

    <div class="dynamic-panel">
        <div class="panel-header"><h2 id="panel-title">Resumo</h2></div>
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-label">Total Geral</div><div class="stat-value" id="p-total">0</div></div>
            <div class="stat-card"><div class="stat-label">Média Time</div><div class="stat-value" id="p-media-time">0</div></div>
            <div class="stat-card"><div class="stat-label">Média/Assistente</div><div class="stat-value" id="p-media-ind">0</div></div>
            <div class="stat-card"><div class="stat-label">Headcount</div><div class="stat-value" id="p-headcount">0</div></div>
        </div>
    </div>

    <div class="table-card" style="overflow-x:auto;">
        <table id="main-table"><thead><tr id="table-header"><th>Indicadores</th></tr></thead><tbody id="table-body"></tbody></table>
    </div>
</div>

<script src="assets/js/config.js"></script>
<script src="assets/js/auth.js"></script>
<script src="assets/js/layout.js"></script>

<script>
    const FIXED_HEADCOUNT = 17;

    function init() {
        const yearSel = document.getElementById('year-selector');
        const currentYear = new Date().getFullYear();
        for(let y = currentYear; y >= 2024; y--) yearSel.innerHTML += `<option value="${y}">${y}</option>`;
        atualizarOpcoes(); 
    }

    function atualizarOpcoes() {
        // ... (Código de atualizarOpcoes igual ao anterior) ...
        const type = document.getElementById('period-type').value;
        const valSel = document.getElementById('period-value');
        // Preenchimento de opções
        valSel.innerHTML = '';
        if(type === 'mes') { /* ... */ } // Simplificado aqui, use o código completo
        // ...
        carregarRelatorio();
    }

    // Copie aqui as funções: getRange, carregarRelatorio, getBucket, getColumnNames, processarTabela, createEmptyStat, zerarPainel
    // Exatamente como no código anterior do consolidado.html, apenas sem o bloco de auth/config.

    init();
</script>
</body>
</html>
