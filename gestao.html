<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GestÃ£o - Gupy</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --primary: #e11d48; --bg: #f8fafc; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .header { display: flex; justify-content: space-between; align-items: center; background: white; padding: 1rem 1.5rem; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .btn { padding: 10px 18px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; color: white; font-size: 0.9rem; }
        .tab-btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; background: #f1f5f9; margin-right: 5px; font-weight: 600; color: #64748b; }
        .tab-btn.active { background: var(--primary); color: white; }
        .hidden { display: none; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.9rem; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #f1f5f9; }
        input, select { padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px; margin-bottom: 10px; font-size: 0.9rem; }
    </style>
</head>
<body>
    <div class="header">
        <h2 style="margin:0; font-size: 1.2rem;">Painel de Controle</h2>
        <div>
            <button class="btn" onclick="window.location.href='produtividade.html'" style="background:#0284c7;">ðŸ“Š Acessar Dashboard</button>
            <button class="btn" onclick="localStorage.removeItem('usuario'); window.location.href='index.html'" style="background:#64748b; margin-left:10px;">Sair</button>
        </div>
    </div>
    <div class="card">
        <div style="margin-bottom: 20px;">
            <button class="tab-btn active" id="btn-u" onclick="switchTab('usuarios')">Equipe</button>
            <button class="tab-btn" id="btn-m" onclick="switchTab('metas')">Metas Vigentes</button>
        </div>
        
        <div id="tab-usuarios">
            <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap:12px; margin-bottom: 15px;">
                <input type="number" id="u-id" placeholder="ID NumÃ©rico">
                <input type="text" id="u-nome" placeholder="Nome da Assistente">
                <select id="u-fun"><option value="Assistente">Assistente</option><option value="Auditora">Auditora</option><option value="Gestora">Gestora</option></select>
                <select id="u-con"><option value="CLT">CLT</option><option value="PJ">PJ</option><option value="CLT PCD">CLT PCD</option></select>
            </div>
            <button class="btn" style="background:#10b981;" onclick="addU()">Salvar Cadastro</button>
            <table id="lista-u"><thead><tr><th>ID</th><th>Nome</th><th>FunÃ§Ã£o</th><th>Contrato</th></tr></thead><tbody></tbody></table>
        </div>

        <div id="tab-metas" class="hidden">
            <div style="display:flex; gap:12px; margin-bottom: 15px; flex-wrap: wrap;">
                <select id="m-user" style="flex:1; min-width: 200px;"></select>
                <input type="number" id="m-val" placeholder="Meta DiÃ¡ria" style="width: 150px;">
                <input type="date" id="m-data">
            </div>
            <button class="btn" style="background:var(--primary);" onclick="addM()">Atualizar Meta</button>
            <table id="lista-m"><thead><tr><th>Colaborador</th><th>Meta</th><th>InÃ­cio</th></tr></thead><tbody></tbody></table>
        </div>
    </div>
<script>
    const SB_URL = "https://glqrpsyjwozvislyxapj.supabase.co";
    const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdscXJwc3lqd296dmlzbHl4YXBqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyNTQyOTgsImV4cCI6MjA4MTgzMDI5OH0.etzcmIHgPcGC12HwZPTU2u0DLtJdF3XTBSYW38O7S-w";
    const _supabase = supabase.createClient(SB_URL, SB_KEY);
    function switchTab(t){
        document.getElementById('tab-usuarios').classList.toggle('hidden', t!=='usuarios');
        document.getElementById('tab-metas').classList.toggle('hidden', t!=='metas');
        document.getElementById('btn-u').classList.toggle('active', t==='usuarios');
        document.getElementById('btn-m').classList.toggle('active', t==='metas');
    }
    async function addU(){
        await _supabase.from('usuarios').upsert([{id:document.getElementById('u-id').value, nome:document.getElementById('u-nome').value, funcao:document.getElementById('u-fun').value, contrato:document.getElementById('u-con').value, ativo:true, senha:'123'}]);
        load();
    }
    async function addM(){
        await _supabase.from('metas').insert([{usuario_id:document.getElementById('m-user').value, valor_meta:document.getElementById('m-val').value, data_inicio:document.getElementById('m-data').value}]);
        load();
    }
    async function load(){
        const {data:u} = await _supabase.from('usuarios').select('*').order('nome');
        const {data:m} = await _supabase.from('metas').select('*, usuarios(nome)').order('data_inicio', {ascending:false});
        document.querySelector('#lista-u tbody').innerHTML = u.map(x=>`<tr><td>${x.id}</td><td>${x.nome}</td><td>${x.funcao}</td><td>${x.contrato}</td></tr>`).join('');
        document.getElementById('m-user').innerHTML = u.filter(x=>x.funcao==='Assistente').map(x=>`<option value="${x.id}">${x.nome}</option>`).join('');
        document.querySelector('#lista-m tbody').innerHTML = m.map(x=>`<tr><td>${x.usuarios?.nome}</td><td>${x.valor_meta}</td><td>${x.data_inicio}</td></tr>`).join('');
    }
    load();
</script>
</body>
</html>
