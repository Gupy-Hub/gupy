<div class="top-controls">
    <div class="control-group" style="flex: 1.5;">
        <label>Anﾃ｡lise de:</label>
        <select id="user-selector" onchange="carregarPerformance()">
            <option value="TEAM">則 VISﾃグ GERAL DO TIME</option>
        </select>
    </div>
    
    <div class="control-group">
        <label>Tipo de Perﾃｭodo</label>
        <select id="period-type" onchange="atualizarOpcoesPeriodo()"> <option value="mes" selected>Mensal</option>
            <option value="trimestre">Trimestral</option>
            <option value="semestre">Semestral</option>
            <option value="ano">Anual</option>
        </select>
    </div>

    <div class="control-group">
        <label>Ano</label>
        <select id="year-selector" onchange="carregarPerformance()"></select> </div>

    <div class="control-group" style="flex: 1.2;">
        <label>Perﾃｭodo Especﾃｭfico</label>
        <select id="period-value" onchange="carregarPerformance()"></select> </div>
</div>

<script>
    // ... (Mantenha as configuraﾃｧﾃｵes do Supabase e Login que jﾃ｡ estﾃ｣o no topo) ...

    // --- FUNﾃﾃグ DE INICIALIZAﾃﾃグ DE DATAS ---
    function initDates() {
        const yearSel = document.getElementById('year-selector');
        const currentYear = new Date().getFullYear();
        
        // Limpa e preenche anos
        yearSel.innerHTML = ''; 
        for(let y = currentYear; y >= 2024; y--) {
            yearSel.innerHTML += `<option value="${y}">${y}</option>`;
        }
        
        // IMPORTANTE: Chama a atualizaﾃｧﾃ｣o das opﾃｧﾃｵes assim que termina de criar os anos
        atualizarOpcoesPeriodo();
    }

    // --- FUNﾃﾃグ QUE CORRIGE O SELETOR VAZIO ---
    function atualizarOpcoesPeriodo() {
        const type = document.getElementById('period-type').value;
        const valSel = document.getElementById('period-value');
        
        // Limpa as opﾃｧﾃｵes atuais
        valSel.innerHTML = '';
        
        const meses = ['Janeiro','Fevereiro','Marﾃｧo','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'];
        const mesAtual = new Date().getMonth(); // 0 a 11

        if(type === 'mes') {
            meses.forEach((m, i) => {
                // Seleciona automaticamente o mﾃｪs atual
                const isSelected = i === mesAtual ? 'selected' : '';
                valSel.innerHTML += `<option value="${i+1}" ${isSelected}>${m}</option>`;
            });
        } 
        else if(type === 'trimestre') {
            valSel.innerHTML = `
                <option value="1">1ﾂｺ Trimestre (Jan-Mar)</option>
                <option value="2">2ﾂｺ Trimestre (Abr-Jun)</option>
                <option value="3">3ﾂｺ Trimestre (Jul-Set)</option>
                <option value="4">4ﾂｺ Trimestre (Out-Dez)</option>`;
        } 
        else if(type === 'semestre') {
            valSel.innerHTML = `
                <option value="1">1ﾂｺ Semestre (Jan-Jun)</option>
                <option value="2">2ﾂｺ Semestre (Jul-Dez)</option>`;
        } 
        else { // Anual
            valSel.innerHTML = `<option value="1">Ano Completo</option>`;
        }

        // Apﾃｳs preencher as opﾃｧﾃｵes, carrega os dados do grﾃ｡fico
        carregarPerformance();
    }

    // ... (Mantenha o restante das funﾃｧﾃｵes getRangeDates, carregarPerformance, etc.) ...

    // Garanta que no final do script, dentro da funﾃｧﾃ｣o init(), vocﾃｪ chame initDates()
    async function init() {
        initDates(); // Isso dispara a cascata para preencher o select
        
        // Carrega usuﾃ｡rios...
        const { data: users } = await _supabase.from('usuarios').select('*').order('nome');
        const sel = document.getElementById('user-selector');
        // ... resto do seu cﾃｳdigo de usuﾃ｡rios ...
    }

    // Inicia tudo
    init();
</script>
